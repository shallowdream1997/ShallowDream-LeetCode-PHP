@startuml
title Amazon SP多种账号广告自动化 - 下架SKU
autonumber

box "product_operation_php_restful" #lightBlue

participant "UploadProcessAliyunController" as uploadPrecess
participant "PA自动化下架广告接口" as paAutoAmazonSP
end box

box "nsq_worker_nodejs_app" #lightYellow
participant "HK_Poms_Send_Amazon_Create_Sp" as HK_Poms_Send_Amazon_Create_Sp
end box

box "poms_selling_partner_php_restful" #lightGreen
participant "Amazon广告服务" as amazon
end box

box "database" #lightYellow
participant "mongoDB" as db
end box
group 发起关闭product广告
uploadPrecess -> uploadPrecess : 下架SKU成功\n判断当前sku是否需要关闭prodcut广告\n<color #red>(增加需要关闭广告的账号:amazon_jp账号)
alt 当前sku需要关闭prodcut广告
uploadPrecess -> HK_Poms_Send_Amazon_Create_Sp : 发起队列,关闭prodcut广告
end
end

group 关闭product广告
HK_Poms_Send_Amazon_Create_Sp --> paAutoAmazonSP : 分发处理

paAutoAmazonSP -> db : 获取是否已存在product广告
db --> paAutoAmazonSP : 返回是否存在product广告结果

alt 存在product广告
paAutoAmazonSP -> amazon : 关闭product广告
amazon --> paAutoAmazonSP : 返回关闭广告的结果

alt 关闭广告成功
paAutoAmazonSP -> db : 更新广告信息
db --> paAutoAmazonSP : 返回处理结果
end
end
end


@enduml