https://wise-3.ux168.cn/#/chat

uml流程图，用puml写出来一个流程图：

流程A:

用户A保存资料，如果资料的按钮类型是UpdateAttribute 或者 updateForbiddenWord，就进入预计创建资料变更的接口，否则就做其他操作。

进入预计创建资料变更接口，如果资料的平台、渠道和属性都符合来自配置config的数据的要求，就创建 审批状态 = 10(新建) 的单据，否则就 不创建单据。

创建单据后，发起处理资料单据的MQ，更新资料 流程状态 = 10(等待翻译)，

接收处理资料单据的MQ后，开始翻译，更新 流程状态 = 20(翻译中), 调用 translation-node-js接口，返回结果，如果 结果有值，就更新 流程状态 = 30(翻译完成)，否则就 更新 流程状态 = 40(翻译失败)，中止下一步

翻译完成的单据，继续下一步，更新 流程状态 = 60(禁词检查中), 然后开始禁词检查，调用禁词检查接口，获取接口返回，如果 接口调用成功就 更新 流程状态 = 70(禁词检查完成)，否则就 更新 流程状态 = 80(禁词检查失败)，中止下一步；

禁词检查完成后，开始 调用检查字符长度的接口，接口返回结果不管长度是否符合 都更新 流程状态 = 100(长度检查成功)，如果接口调用失败，就更新流程状态 = 110(长度检查失败)，中止下一步;

在上述检查(没有中止)都结束之后，如果禁词检查接口结果 存在禁词，就存储禁词内容，如果长度不符合并且修改 审批状态； 如果长度不符合条件，就记录 不符合条件的原因，如果 翻译有结果，就存储翻译内容，最后 更新流程状态 = 120(全部检查完毕) 和 更新 审批状态 = 20(待审核), 这里结束流程A


流程B：
用户B点击更新单据，如果审批状态 = 20(待审核)的，发起 处理资料单据的MQ，更新 审批状态 = 30(检查更新中) 和 流程状态 = 50(等待禁词检查), 否则 中止下一步；

接收 处理资料单据的MQ，更新 流程状态 = 60(禁词检查中)，然后开始禁词检查，调用禁词检查接口，获取接口返回，如果 接口调用成功就 更新 流程状态 = 70(禁词检查完成)，否则就 更新 流程状态 = 80(禁词检查失败)，中止下一步,更新 审批状态 = 40(检查不通过)；

如果是禁词检查完成，就开始 调用检查字符长度的接口，接口返回结果不管长度是否符合 都更新 流程状态 = 100(长度检查成功)，如果接口调用失败，就更新流程状态 = 110(长度检查失败)，中止下一步;

在上述检查(没有中止)都结束之后，如果禁词检查接口结果 存在禁词，就存储禁词内容，如果长度不符合并且修改 审批状态； 如果长度不符合条件，就记录 不符合条件的原因，最后 更新流程状态 = 120(全部检查完毕) 和 更新 审批状态 = 40(检查不通过)

如果不存在禁词，且长度都符合要求，就更新流程状态 = 120(全部检查完毕) 和 更新 审批状态 = 50(检查通过)，然后开始发起 更新资料的接口，更新审批状态 = 60(正在更新中)

更新资料完成，成功就更新 审批状态 = 70(已更新),失败就更新 审批状态 = 80(更新失败); 这里结束流程B

以上审批状态和流程状态的文字分别帮忙标红色 和 绿色


用户C点击忽略单据，审批状态 = 90(已忽略)，这里结束流程B；


流程C：
用户D 导入批量审核更新，上传oss文件，调用导入批量审核更新接口，发起MQ，先获取oss文件解析文件内容，存储属性翻译数据，和对应属性在单据上的主键ID，和平台，操作人，oss文件路径。存储数据失败，就生成失败内容，整理成xlsx文档，上传oss，再发送钉钉提醒用户报错，贴上导入文件明细，重新导入。

如果文件解析成功，数据记录成功，文件里面的每一个单据，都走流程B一样的逻辑。一样也会发送钉钉通知提醒业务，查看进度。在部分数据检查不通过时，就钉钉提醒报错，贴上导入文件明细，解决问题之后，重新导入。

如果文件里面的所有的单据都检查通过后，根据sku 分组，获取所有的变更属性，批量更新sku资料。 每个sku资料更新，完毕后，就对这个sku的属性的单据，更新 审批状态 = 70，否则就 审批状态 = 80；






uml时序图，用puml写出来一个时序图：

流程A:

title 为 资料变更单据创建
然后开始autonumber

有一个actor 用户 命名为 customer



用户A保存资料，如果资料的按钮类型是UpdateAttribute 或者 updateForbiddenWord，就进入预计创建资料变更的接口，否则就做其他操作。

进入预计创建资料变更接口，如果资料的平台、渠道和属性都符合来自配置config的数据的要求，就创建 审批状态 = 10(新建) 的单据，否则就 不创建单据。

创建单据后，发起处理资料单据的MQ，更新资料 流程状态 = 10(等待翻译)，

接收处理资料单据的MQ后，开始翻译，更新 流程状态 = 20(翻译中), 调用 translation-node-js接口，返回结果，如果 结果有值，就更新 流程状态 = 30(翻译完成)，否则就 更新 流程状态 = 40(翻译失败)，中止下一步

翻译完成的单据，继续下一步，更新 流程状态 = 60(禁词检查中), 然后开始禁词检查，调用禁词检查接口，获取接口返回，如果 接口调用成功就 更新 流程状态 = 70(禁词检查完成)，否则就 更新 流程状态 = 80(禁词检查失败)，中止下一步；

禁词检查完成后，开始 调用检查字符长度的接口，接口返回结果不管长度是否符合 都更新 流程状态 = 100(长度检查成功)，如果接口调用失败，就更新流程状态 = 110(长度检查失败)，中止下一步;

在上述检查(没有中止)都结束之后，如果禁词检查接口结果 存在禁词，就存储禁词内容，如果长度不符合并且修改 审批状态； 如果长度不符合条件，就记录 不符合条件的原因，如果 翻译有结果，就存储翻译内容，最后 更新流程状态 = 120(全部检查完毕) 和 更新 审批状态 = 20(待审核), 这里结束流程A


