@startuml
start

:用户B点击更新单据;

if (审批状态 = 20(待审核)?) then (是)
    :发起处理资料单据的MQ;
    :更新审批状态 = 30(检查更新中);
    :更新流程状态 = 50(等待禁词检查);
else (否)
    :报错提示;
    stop
endif

:接收处理资料单据的MQ;
:更新流程状态 = 60(禁词检查中);
:开始禁词检查;
:调用禁词检查接口;

if (接口调用成功?) then (是)
    :更新流程状态 = 70(禁词检查完成);
else (否)
    :更新流程状态 = 80(禁词检查失败);
    :更新审批状态 = 40(检查不通过);
    stop
endif

:调用检查字符长度的接口;

if (接口调用成功?) then (是)
    :更新流程状态 = 100(长度检查成功);
else (否)
    :更新流程状态 = 110(长度检查失败);
    stop
endif

if (禁词检查接口结果存在禁词?) then (是)
    :存储禁词内容;
endif

if (长度不符合条件?) then (是)
    :记录不符合条件的原因;
endif

:更新流程状态 = 120(全部检查完毕);

if (不存在禁词且长度符合要求?) then (是)
    :更新审批状态 = 50(检查通过);
    :发起更新资料的接口;
    :更新审批状态 = 60(正在更新中);

    if (更新资料成功?) then (是)
        :更新审批状态 = 70(已更新);
    else (否)
        :更新审批状态 = 80(更新失败);
    endif
else (否)
    :更新审批状态 = 40(检查不通过);
endif

stop
@enduml
